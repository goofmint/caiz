
# 要件

すべてNodeBBのプラグインとして実装する
サーバーとの通信はWebSocketを通じて行う

# 完了済み機能

- [x] コミュニティサイドバーの基本実装
- [x] コミュニティフォロー/アンフォロー機能
- [x] コミュニティ一覧表示機能
- [x] サイドバーのトグル機能
- [x] トップレベルカテゴリのフィルタリング

# タスク一覧

- [x] 01: 未ログインだった場合、参加コミュニティ一覧を非表示にする
- [x] 02: 自分がコミュニティオーナーだった場合、コミュニティトップに `Edit` ボタンを設ける
- [x] 03: 自分がコミュニティオーナーだった場合、コミュニティ情報を編集できるモーダルを表示する
  - [x] 03a: コミュニティ名（名前、スラグ、詳細、ロゴ）を編集できる
  - [x] 03b: コミュニティ以下のカテゴリーを編集（追加、削除、編集）できる
  - [x] 03c: メンバーのロール管理を行う（オーナー、マネージャー、メンバー、バン）
- [x] 04: plugins/nodebb-plugin-caiz/libs/community.js が肥大化しているので分割
- [x] 05: 投稿時にAIでモデレーションを行う。しきい値を超える場合、要モデレーションのフラグを立てる
  - [x] 05a: 専用プラグインの作成（基本実装とシンプルな管理画面）
  - [x] 05b: 設定の保存、フォームへの復元、更新
  - [x] 05c: API接続のテスト機能の実装
  - [x] 05d: フィルターの設定（トピック作成、コメント作成、返信）。モデレーションはまだ実装しない
  - [x] 05e: システム管理者用設定画面の作成（APIキーの入力、デフォルト値のしきい値の設定）
  - [x] 05f: モデレーションの実装（判定結果の保存、通知機能の実装）
- 06: モデレーション
  - [x] 06g: コミュニティ（親カテゴリー）作成時に、owner/managerグループに対して当該コミュニティへのモデレート権限（'read', 'topics:read', 'moderate'）を付与する
- [x] フォロー中・未フォローのラベルが逆っぽいので修正
- [x] コミュニティ作成時のデフォルトのサブカテゴリーの説明文、アイコンの変更（ドキュメントのみ）
- [x] 07: メンバーしか書き込み不可
- コミュニティ編集
  - [x] Editにデンジャーゾーン（コミュニティ削除）
- [x] 09: AIサマリー機能の実装（独立プラグイン `nodebb-plugin-ai-topic-summary` として作成）
  - [x] スレッドの流れをAIでまとめて保存する（10スレッドごとに）。
  - [x] スレッドのトップで、AIスレッドの要約を表示する
- [x] スレッドの作成モーダルが左寄りになっている
- [x] スレッドには「フォロー」「フォロー解除」ボタンは不要
- [x] コミュニティ一覧のサイドバーで、画像の場合に何も表示されないので修正
- [x] コミュニティ一覧のサイドバーで、開閉した状態について、ブラウザを再読込しても維持してほしい
- [x] 自分しかコミュニティオーナーがいない場合、メンバーを抜けることは不可
- [x] コミュニティ作成時に `Uncaught (in promise) TypeError: alert is not a function    at Socket.eval (scripts-client.js:2151:17)`
- [x] コミュニティ名に `/` を含むと、コミュニティ作成エラー（実際には作成できている）
- [x] /recent と /popular /unread で、コミュニティ名を表示する
- [x] /communities を2列表示に（画面幅による）
- [x] /communities ではMarkdown禁止に

# 第2フェーズ

- MCPサーバー
- 追加レンダリング
  - [ ] Mermaid
  - [ ] MathJax
  - [ ] KaTeX
  - [ ] PlantUML
- API用トークンの管理
- Webhook
- 埋め込み
  - YouTube
  - X
  - GitHub Snippet
  - URLのOGP表示
- 連携
  - [ ] Slack
  - [ ] Discord
  - [ ] Microsoft Teams
- 配信
  - [ ] RTMP受信
- コミュニティごとの未読表示
