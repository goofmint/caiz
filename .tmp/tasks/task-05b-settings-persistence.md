# タスク 05b: AIモデレーション設定の永続化

## 概要
AIモデレーションプラグインの管理画面で設定した値を適切に保存し、画面読み込み時に復元できるようにする。

## 要件

### 設定の保存機能
- 管理画面の「設定を保存」ボタン押下時に、フォーム内容をNodeBBのデータベースに保存
- 保存対象の設定値：
  - `apiKey`: OpenAI APIキー（暗号化して保存）
  - `thresholds.flag`: フラグ閾値（デフォルト: 70）
  - `thresholds.reject`: 拒否閾値（デフォルト: 90）

### 設定の復元機能
- 管理画面読み込み時に、保存済み設定をフォームに復元
- APIキーは保存されていることを示すが、実際の値は表示しない（セキュリティ上の理由）
- 設定が未保存の場合はデフォルト値を表示

### データ構造
設定は以下の構造でNodeBBデータベースに保存：

```javascript
{
  provider: 'openai',
  apiKey: '[encrypted]',
  thresholds: {
    flag: 70,
    reject: 90
  }
}
```

## 技術実装

### バックエンド修正
- `libs/core/settings.js`の`saveSettings()`と`getSettings()`メソッドを実装
- NodeBBの`db.setObject()`と`db.getObject()`を使用
- APIキーは暗号化して保存（NodeBBの組み込み暗号化機能を利用）

### フロントエンド修正
- `static/lib/admin.js`でNodeBBのSettings APIを使用
- フォーム読み込み時に`Settings.load()`で設定復元
- 保存時に`Settings.save()`で設定保存
- APIキーフィールドは保存済みの場合プレースホルダーで状態表示

### セキュリティ考慮
- APIキーは暗号化して保存
- 管理画面でのAPIキー表示は避ける（保存状態のみ表示）
- 設定保存時の権限チェック（管理者のみ）

## 完了条件
- [ ] 管理画面で設定値を入力して保存できる
- [ ] 画面再読み込み時に保存済み設定が復元される
- [ ] APIキーが安全に暗号化されて保存される
- [ ] デフォルト値が適切に設定される
- [ ] エラーハンドリングが適切に動作する