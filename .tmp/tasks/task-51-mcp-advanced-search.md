# 51. MCPサーバーで、詳細な検索条件のサポート（コミュニティ以下のカテゴリー、タグ、投稿ユーザー、日付範囲）

- [ ] 設計レビュー完了

本ドキュメントは、`nodebb-plugin-mcp-server` 内で扱うインタフェース仕様（設計のみ、実装は含まない）として、MCPサーバー経由の検索ツールにおける「詳細な検索条件」を定義する。

## 目的

- コミュニティ配下のカテゴリー、タグ、投稿ユーザー、日付範囲を含む詳細検索条件を一貫した構造で表現する。
- MCPツール（JSON-RPC）経由で利用できるように、入出力の契約（Contract）を明確にする。

## スコープ

- インタフェース定義とフィールド意味の説明のみを提示する。
- NodeBB i18nは利用しない（本ドキュメントは設計であり、翻訳キーの追加やテンプレート修正は対象外）。
- 既存のAPIを置換・改変せず、将来的な拡張点としての合意インタフェース提示にとどめる。

## インタフェース（TypeScript）

以下は `nodebb-plugin-mcp-server` の拡張で実装を行う。
現在、認証ユーザーの所属するコミュニティ以下に限定しているが、さらにコミュニティ配下のカテゴリーを指定したり、タグ、投稿ユーザー、日付範囲での絞り込みを行うためのインタフェースを定義する。

### フィールド説明

- categorySlugs: 指定コミュニティ配下のカテゴリをフラットな配列で列挙。ネスト構造は使用しない。
- includeSubcategories: true の場合、指定カテゴリの子孫カテゴリも含む。
- tags: 付与タグによる絞り込み。配列内の論理はANDとし、OR等の複合は将来の仕様検討（実装側の責務）。
- authorUserIds / authorUsernames: 投稿者で絞り込み。両方指定時の優先は実装側で定義する。
- dateRange.from/to: ISO 8601での期間指定。境界の含み方は実装仕様で定義（推奨: 両端含む）。
- page / pageSize: ページネーション。
- sort: 並び順。`relevance`（関連度）、`newest`（新しい順）、`oldest`（古い順）。

## ノート（非機能要件）

- フォールバック禁止：設定や外部依存が不足する場合は明確にエラーを返す方針を採用する。
- i18n留意点：翻訳キーは `[[namespace:key]]` のフラット構造で定義する必要がある。

